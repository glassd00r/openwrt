From ccbd0dbfe85bcaf7e936240e8f7bab1ccd6486e9 Mon Sep 17 00:00:00 2001
Message-ID: <ccbd0dbfe85bcaf7e936240e8f7bab1ccd6486e9.1770895923.git.lorenzo@kernel.org>
From: Lorenzo Bianconi <lorenzo@kernel.org>
Date: Thu, 12 Feb 2026 11:17:20 +0100
Subject: [bpf-next 1/7] net: airoha: Add DMA address field to
 airoha_tx_irq_queue struct

Signed-off-by: Lorenzo Bianconi <lorenzo@kernel.org>
---
 drivers/net/ethernet/airoha/airoha_eth.c | 5 ++---
 drivers/net/ethernet/airoha/airoha_eth.h | 1 +
 2 files changed, 3 insertions(+), 3 deletions(-)

--- a/drivers/net/ethernet/airoha/airoha_eth.c
+++ b/drivers/net/ethernet/airoha/airoha_eth.c
@@ -1017,12 +1017,11 @@ static int airoha_qdma_tx_irq_init(struc
 {
 	int id = irq_q - &qdma->q_tx_irq[0];
 	struct airoha_eth *eth = qdma->eth;
-	dma_addr_t dma_addr;
 
 	netif_napi_add_tx(eth->napi_dev, &irq_q->napi,
 			  airoha_qdma_tx_napi_poll);
 	irq_q->q = dmam_alloc_coherent(eth->dev, size * sizeof(u32),
-				       &dma_addr, GFP_KERNEL);
+				       &irq_q->dma_addr, GFP_KERNEL);
 	if (!irq_q->q)
 		return -ENOMEM;
 
@@ -1030,7 +1029,7 @@ static int airoha_qdma_tx_irq_init(struc
 	irq_q->size = size;
 	irq_q->qdma = qdma;
 
-	airoha_qdma_wr(qdma, REG_TX_IRQ_BASE(id), dma_addr);
+	airoha_qdma_wr(qdma, REG_TX_IRQ_BASE(id), irq_q->dma_addr);
 	airoha_qdma_rmw(qdma, REG_TX_IRQ_CFG(id), TX_IRQ_DEPTH_MASK,
 			FIELD_PREP(TX_IRQ_DEPTH_MASK, size));
 	airoha_qdma_rmw(qdma, REG_TX_IRQ_CFG(id), TX_IRQ_THR_MASK,
--- a/drivers/net/ethernet/airoha/airoha_eth.h
+++ b/drivers/net/ethernet/airoha/airoha_eth.h
@@ -208,6 +208,7 @@ struct airoha_tx_irq_queue {
 
 	int size;
 	u32 *q;
+	dma_addr_t dma_addr;
 };
 
 struct airoha_hw_stats {
